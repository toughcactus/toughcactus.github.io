<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Part 1 绑定键位 # 虚幻编辑器 项目设置 &gt; Engine &gt; Input 动作映射 函数描述 Run 键位 LeftShift 虽然是跑步键位，但是限制方向为向前 要求同时按下 W 或 Up 要求速度不为0 前方有障碍物时，不应该由走路转换成跑步动画 动作映射的回调函数参数列表为空 判断是否为前进方向时，还可根据速度矢量和朝向的夹角 Part 2 实现跑步逻辑 # C&#43;&#43; 一、判断跑步键位是否按下，方向是否为前进 # 数据成员 private bool IsForward = false; bool AbleRun = false; 二、实现键位按下逻辑，绑定函数描述和回调函数 # 函数成员 private 在SetupPlayerInputComponent中调用InitRun void ASTBaseCharacter::RunEnable() { AbleRun = true; } void ASTBaseCharacter::RunDisable() { AbleRun = false; } void ASTBaseCharacter::InitRun(UInputComponent* PlayerInputComponent) { PlayerInputComponent-&gt;BindAction(&#34;Run&#34;, IE_Pressed, this, &amp;ASTBaseCharacter::RunEnable); PlayerInputComponent-&gt;BindAction(&#34;Run&#34;, IE_Released, this, &amp;ASTBaseCharacter::RunDisable);	} 三、判断方向是否为前进 # 函数成员 private 在MoveForward中调用 void ASTBaseCharacter::SetIsForward(float Amount) { IsForward = Amount &gt; 0.">
<meta name="theme-color" content="#FFFFFF">
<meta name="color-scheme" content="light dark"><meta property="og:title" content="实现Character跑步" />
<meta property="og:description" content="Part 1 绑定键位 # 虚幻编辑器 项目设置 &gt; Engine &gt; Input 动作映射 函数描述 Run 键位 LeftShift 虽然是跑步键位，但是限制方向为向前 要求同时按下 W 或 Up 要求速度不为0 前方有障碍物时，不应该由走路转换成跑步动画 动作映射的回调函数参数列表为空 判断是否为前进方向时，还可根据速度矢量和朝向的夹角 Part 2 实现跑步逻辑 # C&#43;&#43; 一、判断跑步键位是否按下，方向是否为前进 # 数据成员 private bool IsForward = false; bool AbleRun = false; 二、实现键位按下逻辑，绑定函数描述和回调函数 # 函数成员 private 在SetupPlayerInputComponent中调用InitRun void ASTBaseCharacter::RunEnable() { AbleRun = true; } void ASTBaseCharacter::RunDisable() { AbleRun = false; } void ASTBaseCharacter::InitRun(UInputComponent* PlayerInputComponent) { PlayerInputComponent-&gt;BindAction(&#34;Run&#34;, IE_Pressed, this, &amp;ASTBaseCharacter::RunEnable); PlayerInputComponent-&gt;BindAction(&#34;Run&#34;, IE_Released, this, &amp;ASTBaseCharacter::RunDisable);	} 三、判断方向是否为前进 # 函数成员 private 在MoveForward中调用 void ASTBaseCharacter::SetIsForward(float Amount) { IsForward = Amount &gt; 0." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://toughcactus.github.io/docs/%E8%99%9A%E5%B9%BB%E5%BC%95%E6%93%8E/%E8%BF%9B%E9%98%B6%E8%AF%BE%E7%A8%8B/%E8%A7%92%E8%89%B2%E5%92%8C%E5%8A%A8%E7%94%BB/1.9%E5%AE%9E%E7%8E%B0Character%E8%B7%91%E6%AD%A5/" /><meta property="article:section" content="docs" />


<title>实现Character跑步 | ToughCactus</title>
<link rel="manifest" href="/manifest.json">
<link rel="icon" href="/favicon.png" type="image/x-icon">
<link rel="stylesheet" href="/book.min.26e8a33fc5e9707933ffab2518e6539daefade68be907348abbd9429a6bb8eb5.css" integrity="sha256-JuijP8XpcHkz/6slGOZTna763mi&#43;kHNIq72UKaa7jrU=" crossorigin="anonymous">
  <script defer src="/flexsearch.min.js"></script>
  <script defer src="/en.search.min.ad0899be44f42ef336a949276df2520691c8797547ba8ceaf8a2f42aecc19d36.js" integrity="sha256-rQiZvkT0LvM2qUknbfJSBpHIeXVHuozq&#43;KL0KuzBnTY=" crossorigin="anonymous"></script>

  <script defer src="/sw.min.6f6f90fcb8eb1c49ec389838e6b801d0de19430b8e516902f8d75c3c8bd98739.js" integrity="sha256-b2&#43;Q/LjrHEnsOJg45rgB0N4ZQwuOUWkC&#43;NdcPIvZhzk=" crossorigin="anonymous"></script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  
</head>
<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/"><span>ToughCactus</span>
  </a>
</h2>


<div class="book-search">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>












  



  
  <ul>
    
      
        <li class="book-section-flat" >
          
  
  

  
    <span>虚幻引擎</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-a30b888d97cedd0e72fd98dd83a446d9" class="toggle"  />
    <label for="section-a30b888d97cedd0e72fd98dd83a446d9" class="flex justify-between">
      <a role="button" class="">基础课程</a>
    </label>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-9c55d44374101bd87d8c4761c8d07c64" class="toggle" checked />
    <label for="section-9c55d44374101bd87d8c4761c8d07c64" class="flex justify-between">
      <a role="button" class="">进阶课程</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-1d099f39b37c7d342e94ef6f0f3007bb" class="toggle" checked />
    <label for="section-1d099f39b37c7d342e94ef6f0f3007bb" class="flex justify-between">
      <a role="button" class="">角色和动画</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/%E8%99%9A%E5%B9%BB%E5%BC%95%E6%93%8E/%E8%BF%9B%E9%98%B6%E8%AF%BE%E7%A8%8B/%E8%A7%92%E8%89%B2%E5%92%8C%E5%8A%A8%E7%94%BB/1.1%E5%9C%A8%E6%9C%AC%E5%9C%B0%E8%BF%90%E8%A1%8CShooterGame%E7%A4%BA%E4%BE%8B%E9%A1%B9%E7%9B%AE/" class="">运行ShooterGame示例项目</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/%E8%99%9A%E5%B9%BB%E5%BC%95%E6%93%8E/%E8%BF%9B%E9%98%B6%E8%AF%BE%E7%A8%8B/%E8%A7%92%E8%89%B2%E5%92%8C%E5%8A%A8%E7%94%BB/1.2%E5%88%9D%E5%A7%8B%E5%8C%96ShootTraining%E9%A1%B9%E7%9B%AE/" class="">初始化ShootTraining项目</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/%E8%99%9A%E5%B9%BB%E5%BC%95%E6%93%8E/%E8%BF%9B%E9%98%B6%E8%AF%BE%E7%A8%8B/%E8%A7%92%E8%89%B2%E5%92%8C%E5%8A%A8%E7%94%BB/1.3%E4%BB%A3%E7%A0%81%E8%A7%84%E8%8C%83/" class="">代码规范</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/%E8%99%9A%E5%B9%BB%E5%BC%95%E6%93%8E/%E8%BF%9B%E9%98%B6%E8%AF%BE%E7%A8%8B/%E8%A7%92%E8%89%B2%E5%92%8C%E5%8A%A8%E7%94%BB/1.4%E4%B8%BACharacter%E7%BB%91%E5%AE%9A%E6%A8%A1%E5%9E%8B/" class="">为Character绑定模型</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/%E8%99%9A%E5%B9%BB%E5%BC%95%E6%93%8E/%E8%BF%9B%E9%98%B6%E8%AF%BE%E7%A8%8B/%E8%A7%92%E8%89%B2%E5%92%8C%E5%8A%A8%E7%94%BB/1.5%E5%AE%9E%E7%8E%B0Character%E5%89%8D%E5%90%8E%E5%B7%A6%E5%8F%B3%E7%A7%BB%E5%8A%A8/" class="">实现Character前后左右移动</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/%E8%99%9A%E5%B9%BB%E5%BC%95%E6%93%8E/%E8%BF%9B%E9%98%B6%E8%AF%BE%E7%A8%8B/%E8%A7%92%E8%89%B2%E5%92%8C%E5%8A%A8%E7%94%BB/1.6%E5%AE%9E%E7%8E%B0Character%E8%A7%86%E8%A7%92%E6%97%8B%E8%BD%AC/" class="">实现Character视角旋转</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/%E8%99%9A%E5%B9%BB%E5%BC%95%E6%93%8E/%E8%BF%9B%E9%98%B6%E8%AF%BE%E7%A8%8B/%E8%A7%92%E8%89%B2%E5%92%8C%E5%8A%A8%E7%94%BB/1.7%E6%B7%BB%E5%8A%A0%E5%90%91%E5%89%8D%E8%B7%91%E6%AD%A5%E5%8A%A8%E7%94%BB/" class="">为Character添加跑步动画</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/%E8%99%9A%E5%B9%BB%E5%BC%95%E6%93%8E/%E8%BF%9B%E9%98%B6%E8%AF%BE%E7%A8%8B/%E8%A7%92%E8%89%B2%E5%92%8C%E5%8A%A8%E7%94%BB/1.8%E5%AE%9E%E7%8E%B0Character%E8%B7%B3%E8%B7%83/" class="">实现Character跳跃</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/%E8%99%9A%E5%B9%BB%E5%BC%95%E6%93%8E/%E8%BF%9B%E9%98%B6%E8%AF%BE%E7%A8%8B/%E8%A7%92%E8%89%B2%E5%92%8C%E5%8A%A8%E7%94%BB/1.9%E5%AE%9E%E7%8E%B0Character%E8%B7%91%E6%AD%A5/" class="active">实现Character跑步</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/%E8%99%9A%E5%B9%BB%E5%BC%95%E6%93%8E/%E8%BF%9B%E9%98%B6%E8%AF%BE%E7%A8%8B/%E8%A7%92%E8%89%B2%E5%92%8C%E5%8A%A8%E7%94%BB/1.a%E6%B7%BB%E5%8A%A0%E8%BD%AC%E5%90%91%E5%8A%A8%E7%94%BB/" class="">添加转向动画</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/%E8%99%9A%E5%B9%BB%E5%BC%95%E6%93%8E/%E8%BF%9B%E9%98%B6%E8%AF%BE%E7%A8%8B/%E8%A7%92%E8%89%B2%E5%92%8C%E5%8A%A8%E7%94%BB/1.b%E6%89%93%E5%8C%85%E6%B8%B8%E6%88%8F/" class="">打包游戏</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/%E8%99%9A%E5%B9%BB%E5%BC%95%E6%93%8E/%E8%BF%9B%E9%98%B6%E8%AF%BE%E7%A8%8B/%E8%A7%92%E8%89%B2%E5%92%8C%E5%8A%A8%E7%94%BB/1.c%E4%BB%A3%E7%A0%81%E9%87%8D%E6%9E%84/" class="">代码重构</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-abf72c0556c5506bfc005dd76784c9b5" class="toggle"  />
    <label for="section-abf72c0556c5506bfc005dd76784c9b5" class="flex justify-between">
      <a role="button" class="">健康系统</a>
    </label>
  

          
  <ul>
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>















</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 
      </div>
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>实现Character跑步</strong>

  <label for="toc-control">
    
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  
<nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#part-1-绑定键位">Part 1 绑定键位</a></li>
        <li><a href="#part-2-实现跑步逻辑">Part 2 实现跑步逻辑</a>
          <ul>
            <li><a href="#一-判断跑步键位是否按下-方向是否为前进">一、判断跑步键位是否按下，方向是否为前进</a></li>
            <li><a href="#二-实现键位按下逻辑-绑定函数描述和回调函数">二、实现键位按下逻辑，绑定函数描述和回调函数</a></li>
            <li><a href="#三-判断方向是否为前进">三、判断方向是否为前进</a></li>
            <li><a href="#四-判断当前是否满足跑步条件">四、判断当前是否满足跑步条件</a></li>
          </ul>
        </li>
        <li><a href="#part-3-添加跑步动画">Part 3 添加跑步动画</a>
          <ul>
            <li><a href="#一-实现跑步动画">一、实现跑步动画</a></li>
            <li><a href="#二-修改-状态机">二、修改 <code>状态机</code></a>
              <ul>
                <li><a href="#1-dot-添加变量-isrunning-用作状态迁移条件">1. 添加变量 <code>IsRunning</code> 用作状态迁移条件</a></li>
                <li><a href="#2-dot-添加转向动画">2. 添加转向动画</a></li>
                <li><a href="#3-dot-复用转换条件">3. 复用转换条件</a></li>
              </ul>
            </li>
            <li><a href="#三-成果">三、成果</a></li>
          </ul>
        </li>
        <li><a href="#part-4-创建-components-stcharactermovementcomponent">Part 4 创建 <code>Components/STCharacterMovementComponent</code></a></li>
        <li><a href="#part-5-实现跑步加速">Part 5 实现跑步加速</a>
          <ul>
            <li><a href="#1-dot-添加头文件路径">1. 添加头文件路径</a></li>
            <li><a href="#2-dot-可配置-加速系数">2. 可配置 <code>加速系数</code></a></li>
            <li><a href="#3-dot-当-character-跑步时-增加最大速度">3. 当 <code>Character</code> 跑步时，增加最大速度</a></li>
            <li><a href="#4-dot-character-使用自定义-charactermovementcomponent">4. <code>Character</code> 使用自定义 <code>CharacterMovementComponent</code></a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>



  </aside>
  
 
      </header>

      
      
  <article class="markdown"><h2 id="part-1-绑定键位">
  Part 1 绑定键位
  <a class="anchor" href="#part-1-%e7%bb%91%e5%ae%9a%e9%94%ae%e4%bd%8d">#</a>
</h2>
<p><code>虚幻编辑器</code> <br/>
<code>项目设置 &gt; Engine &gt; Input</code> <br/>
<code>动作映射</code> <br/></p>
<ul>
<li>函数描述 <code>Run</code> <br/></li>
<li>键位 <code>LeftShift</code> <br/></li>
</ul>
<p><figure><img src="/pic/%e5%ae%9e%e7%8e%b0Character%e8%b7%91%e6%ad%a5/%e7%bb%91%e5%ae%9a%e8%b7%91%e6%ad%a5%e9%94%ae%e4%bd%8d/%e8%b7%91%e6%ad%a5%e9%94%ae%e4%bd%8d.png" width="500"/>
</figure>
 <br/></p>
<ol>
<li>虽然是跑步键位，但是限制方向为向前 <br/>
要求同时按下 <code>W</code> 或 <code>Up</code> <br/></li>
<li>要求速度不为0 <br/>
前方有障碍物时，不应该由走路转换成跑步动画 <br/></li>
<li>动作映射的回调函数参数列表为空 <br/></li>
<li>判断是否为前进方向时，还可根据速度矢量和朝向的夹角 <br/></li>
</ol>
<h2 id="part-2-实现跑步逻辑">
  Part 2 实现跑步逻辑
  <a class="anchor" href="#part-2-%e5%ae%9e%e7%8e%b0%e8%b7%91%e6%ad%a5%e9%80%bb%e8%be%91">#</a>
</h2>
<p><code>C++</code> <br/></p>
<h3 id="一-判断跑步键位是否按下-方向是否为前进">
  一、判断跑步键位是否按下，方向是否为前进
  <a class="anchor" href="#%e4%b8%80-%e5%88%a4%e6%96%ad%e8%b7%91%e6%ad%a5%e9%94%ae%e4%bd%8d%e6%98%af%e5%90%a6%e6%8c%89%e4%b8%8b-%e6%96%b9%e5%90%91%e6%98%af%e5%90%a6%e4%b8%ba%e5%89%8d%e8%bf%9b">#</a>
</h3>
<p><code>数据成员</code> <code>private</code> <br/></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C++" data-lang="C++"><span style="display:flex;"><span><span style="color:#66d9ef">bool</span> IsForward <span style="color:#f92672">=</span> false;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">bool</span> AbleRun <span style="color:#f92672">=</span> false;
</span></span></code></pre></div><h3 id="二-实现键位按下逻辑-绑定函数描述和回调函数">
  二、实现键位按下逻辑，绑定函数描述和回调函数
  <a class="anchor" href="#%e4%ba%8c-%e5%ae%9e%e7%8e%b0%e9%94%ae%e4%bd%8d%e6%8c%89%e4%b8%8b%e9%80%bb%e8%be%91-%e7%bb%91%e5%ae%9a%e5%87%bd%e6%95%b0%e6%8f%8f%e8%bf%b0%e5%92%8c%e5%9b%9e%e8%b0%83%e5%87%bd%e6%95%b0">#</a>
</h3>
<p><code>函数成员</code> <code>private</code> <code>在SetupPlayerInputComponent中调用InitRun</code> <br/></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C++" data-lang="C++"><span style="display:flex;"><span><span style="color:#66d9ef">void</span> ASTBaseCharacter<span style="color:#f92672">::</span>RunEnable()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    AbleRun <span style="color:#f92672">=</span> true;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> ASTBaseCharacter<span style="color:#f92672">::</span>RunDisable()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    AbleRun <span style="color:#f92672">=</span> false;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> ASTBaseCharacter<span style="color:#f92672">::</span>InitRun(UInputComponent<span style="color:#f92672">*</span> PlayerInputComponent)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    PlayerInputComponent<span style="color:#f92672">-&gt;</span>BindAction(<span style="color:#e6db74">&#34;Run&#34;</span>, IE_Pressed, <span style="color:#66d9ef">this</span>, <span style="color:#f92672">&amp;</span>ASTBaseCharacter<span style="color:#f92672">::</span>RunEnable);
</span></span><span style="display:flex;"><span>    PlayerInputComponent<span style="color:#f92672">-&gt;</span>BindAction(<span style="color:#e6db74">&#34;Run&#34;</span>, IE_Released, <span style="color:#66d9ef">this</span>, <span style="color:#f92672">&amp;</span>ASTBaseCharacter<span style="color:#f92672">::</span>RunDisable);	
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="三-判断方向是否为前进">
  三、判断方向是否为前进
  <a class="anchor" href="#%e4%b8%89-%e5%88%a4%e6%96%ad%e6%96%b9%e5%90%91%e6%98%af%e5%90%a6%e4%b8%ba%e5%89%8d%e8%bf%9b">#</a>
</h3>
<p><code>函数成员</code> <code>private</code> <code>在MoveForward中调用</code> <br/></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C++" data-lang="C++"><span style="display:flex;"><span><span style="color:#66d9ef">void</span> ASTBaseCharacter<span style="color:#f92672">::</span>SetIsForward(<span style="color:#66d9ef">float</span> Amount)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    IsForward <span style="color:#f92672">=</span> Amount <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0.0f</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="四-判断当前是否满足跑步条件">
  四、判断当前是否满足跑步条件
  <a class="anchor" href="#%e5%9b%9b-%e5%88%a4%e6%96%ad%e5%bd%93%e5%89%8d%e6%98%af%e5%90%a6%e6%bb%a1%e8%b6%b3%e8%b7%91%e6%ad%a5%e6%9d%a1%e4%bb%b6">#</a>
</h3>
<p><code>函数成员</code> <br/>
<code>public</code> <code>供其他类使用</code> <code>跑步加速</code> <br/>
<code>const函数</code> <br/>
<code>可在蓝图中调用</code> <br/></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C++" data-lang="C++"><span style="display:flex;"><span>UFUNCTION(BlueprintCallable)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">bool</span> IsRunning() <span style="color:#66d9ef">const</span>;
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C++" data-lang="C++"><span style="display:flex;"><span><span style="color:#66d9ef">bool</span> ASTBaseCharacter<span style="color:#f92672">::</span>IsRunning() <span style="color:#66d9ef">const</span>
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> AbleRun <span style="color:#f92672">&amp;&amp;</span> IsForward <span style="color:#f92672">&amp;&amp;</span> <span style="color:#f92672">!</span>GetVelocity().IsZero();
</span></span><span style="display:flex;"><span>  }
</span></span></code></pre></div><h2 id="part-3-添加跑步动画">
  Part 3 添加跑步动画
  <a class="anchor" href="#part-3-%e6%b7%bb%e5%8a%a0%e8%b7%91%e6%ad%a5%e5%8a%a8%e7%94%bb">#</a>
</h2>
<p><code>虚幻编辑器</code> <br/></p>
<h3 id="一-实现跑步动画">
  一、实现跑步动画
  <a class="anchor" href="#%e4%b8%80-%e5%ae%9e%e7%8e%b0%e8%b7%91%e6%ad%a5%e5%8a%a8%e7%94%bb">#</a>
</h3>
<p><code>一维混合空间</code> <code>BS_Run</code> <br/></p>
<ol>
<li>设置轴 <br/>
<code>Name</code> <code>Velocity</code> <br/>
<code>MaxinumAxisValue</code> <code>600</code> <br/></li>
<li>设置动画 <br/>
<ul>
<li>起点 <code>Idle</code> <br/></li>
<li>终点 <code>RoadieRun_Fwd</code> <br/></li>
</ul>
</li>
</ol>
<h3 id="二-修改-状态机">
  二、修改 <code>状态机</code>
  <a class="anchor" href="#%e4%ba%8c-%e4%bf%ae%e6%94%b9-%e7%8a%b6%e6%80%81%e6%9c%ba">#</a>
</h3>
<p><code>ABP_STBaseCharacter</code> <br/></p>
<h4 id="1-dot-添加变量-isrunning-用作状态迁移条件">
  1. 添加变量 <code>IsRunning</code> 用作状态迁移条件
  <a class="anchor" href="#1-dot-%e6%b7%bb%e5%8a%a0%e5%8f%98%e9%87%8f-isrunning-%e7%94%a8%e4%bd%9c%e7%8a%b6%e6%80%81%e8%bf%81%e7%a7%bb%e6%9d%a1%e4%bb%b6">#</a>
</h4>
<p><code>EventGraph</code> <br/></p>
<ol>
<li>
<p>使用 <code>STBaseCharacter::IsRunning</code> <br/>
需要 <code>Pawn</code> 到 <code>STBaseCharacter</code> 的转换 <br/></p>
<p><figure><img src="/pic/%e5%ae%9e%e7%8e%b0Character%e8%b7%91%e6%ad%a5/%e6%b7%bb%e5%8a%a0%e8%b7%91%e6%ad%a5%e5%8a%a8%e7%94%bb/ABP_BaseCharacter-EventGraph-STBaseCharacter.png" width="700"/>
    </figure>
 <br/></p>
</li>
<li>
<p>设置变量 <code>IsRunning</code> <br/></p>
<p><figure><img src="/pic/%e5%ae%9e%e7%8e%b0Character%e8%b7%91%e6%ad%a5/%e6%b7%bb%e5%8a%a0%e8%b7%91%e6%ad%a5%e5%8a%a8%e7%94%bb/ABP_BaseCharacter-EventGraph-IsRunning.png" width="700"/>
    </figure>
 <br/></p>
</li>
<li>
<p>完整 <code>EventGraph</code> <br/>
可以合并 <code>Pawn</code> 到 <code>Character</code> 和 <code>STBaseCharacter</code> 的转换 <br/></p>
<p><figure><img src="/pic/%e5%ae%9e%e7%8e%b0Character%e8%b7%91%e6%ad%a5/%e6%b7%bb%e5%8a%a0%e8%b7%91%e6%ad%a5%e5%8a%a8%e7%94%bb/ABP_BaseCharacter-EventGraph.png" width="700"/>
    </figure>
 <br/></p>
</li>
</ol>
<h4 id="2-dot-添加转向动画">
  2. 添加转向动画
  <a class="anchor" href="#2-dot-%e6%b7%bb%e5%8a%a0%e8%bd%ac%e5%90%91%e5%8a%a8%e7%94%bb">#</a>
</h4>
<p><code>AnimGraph</code> <br/></p>
<ol>
<li>
<p>添加状态 <code>Run</code> ，使用 <code>BS_Run</code> 作为输入 <br/></p>
<p><figure><img src="/pic/%e5%ae%9e%e7%8e%b0Character%e8%b7%91%e6%ad%a5/%e6%b7%bb%e5%8a%a0%e8%b7%91%e6%ad%a5%e5%8a%a8%e7%94%bb/ABP_BaseCharacter-AnimGraph-Locomotion-AddRun.png" width="600"/>
    </figure>
 <br/></p>
</li>
<li>
<p><code>BS_Run</code> 的输入为 <code>Velocity</code> <br/></p>
<p><figure><img src="/pic/%e5%ae%9e%e7%8e%b0Character%e8%b7%91%e6%ad%a5/%e6%b7%bb%e5%8a%a0%e8%b7%91%e6%ad%a5%e5%8a%a8%e7%94%bb/ABP_BaseCharacter-AnimGraph-Locomotion-Run.png" width="600"/>
    </figure>
 <br/></p>
</li>
<li>
<p>当 <code>IsRunning</code> 为 <code>true</code> 时，从 <code>Walk</code> 迁移到 <code>Run</code> ，否则，从 <code>Run</code> 迁移到 <code>Walk</code> <br/></p>
<p><figure><img src="/pic/%e5%ae%9e%e7%8e%b0Character%e8%b7%91%e6%ad%a5/%e6%b7%bb%e5%8a%a0%e8%b7%91%e6%ad%a5%e5%8a%a8%e7%94%bb/ABP_BaseCharacter-AnimGraph-Locomotion-WalkAndRun.png" width="600"/>
    </figure>
 <br/></p>
<p><figure><img src="/pic/%e5%ae%9e%e7%8e%b0Character%e8%b7%91%e6%ad%a5/%e6%b7%bb%e5%8a%a0%e8%b7%91%e6%ad%a5%e5%8a%a8%e7%94%bb/ABP_BaseCharacter-AnimGraph-Locomotion-WalkToRun.png" width="400"/>
    </figure>
 <br/></p>
<p><figure><img src="/pic/%e5%ae%9e%e7%8e%b0Character%e8%b7%91%e6%ad%a5/%e6%b7%bb%e5%8a%a0%e8%b7%91%e6%ad%a5%e5%8a%a8%e7%94%bb/ABP_BaseCharacter-AnimGraph-Locomotion-RunToWalk.png" width="500"/>
    </figure>
 <br/></p>
</li>
<li>
<p><code>Run</code> 和 <code>Jump</code> 的转换 <br/>
<code>初稿</code> <br/></p>
<p><img src="/pic/实现Character跑步/添加跑步动画/ABP_BaseCharacter-AnimGraph-Locomotion-RunAndJump-Draft.png" alt="ABP_BaseCharacter-AnimGraph-Locomotion-RunAndJump-Draft.png" width="500" /> <br/>
<code>第二稿</code> <br/>
从 <code>JumpEnd</code> 回到 <code>Walk</code> 时，如果 <code>IsRunning</code> 为 <code>true</code> ，会立即切换到 <code>Run</code> <br/>
可以省略 <code>JumpEnd</code> 到 <code>Run</code> 的转换，降低状态机复杂度 <br/></p>
<p><figure><img src="/pic/%e5%ae%9e%e7%8e%b0Character%e8%b7%91%e6%ad%a5/%e6%b7%bb%e5%8a%a0%e8%b7%91%e6%ad%a5%e5%8a%a8%e7%94%bb/ABP_BaseCharacter-AnimGraph-Locomotion-RunAndJump.png" width="500"/>
    </figure>
 <br/></p>
</li>
</ol>
<h4 id="3-dot-复用转换条件">
  3. 复用转换条件
  <a class="anchor" href="#3-dot-%e5%a4%8d%e7%94%a8%e8%bd%ac%e6%8d%a2%e6%9d%a1%e4%bb%b6">#</a>
</h4>
<p><code>AnimGraph</code> <br/>
<code>Run</code> 到 <code>JumpStart</code> 的转换复用 <code>Walk</code> 到 <code>JumpStart</code> 的转换条件 <br/></p>
<ol>
<li>
<p><code>选中Walk到JumpStart的条件 &gt; Details &gt; Transiton &gt; Transition Rule Sharing &gt; Promote To Share</code> <br/></p>
<p><figure><img src="/pic/%e5%ae%9e%e7%8e%b0Character%e8%b7%91%e6%ad%a5/%e6%b7%bb%e5%8a%a0%e8%b7%91%e6%ad%a5%e5%8a%a8%e7%94%bb/WalkToJumpStart-Condition-PromoteToShare.png" width="800"/>
    </figure>
 <br/></p>
</li>
<li>
<p>命名为 <code>IsFalling</code> <br/>
共享条件显示为红色 <br/></p>
<p><figure><img src="/pic/%e5%ae%9e%e7%8e%b0Character%e8%b7%91%e6%ad%a5/%e6%b7%bb%e5%8a%a0%e8%b7%91%e6%ad%a5%e5%8a%a8%e7%94%bb/WalkToJumpStart-Condition-IsFalling.png" width="350"/>
    </figure>
 <br/></p>
<p><figure><img src="/pic/%e5%ae%9e%e7%8e%b0Character%e8%b7%91%e6%ad%a5/%e6%b7%bb%e5%8a%a0%e8%b7%91%e6%ad%a5%e5%8a%a8%e7%94%bb/WalkToJumpStart-Condition-IsFalling-Result.png" width="1100"/>
    </figure>
 <br/></p>
</li>
<li>
<p><code>选中Run到JumpStart的条件 &gt; Details &gt; Transition &gt; Transition Rule Sharing &gt; Use Shared &gt; 选择IsFalling</code> <br/></p>
<p><figure><img src="/pic/%e5%ae%9e%e7%8e%b0Character%e8%b7%91%e6%ad%a5/%e6%b7%bb%e5%8a%a0%e8%b7%91%e6%ad%a5%e5%8a%a8%e7%94%bb/RunToJumpStart-Condition-UseShare.png" width="800"/>
    </figure>
 <br/></p>
</li>
<li>
<p>完整状态机 <br/></p>
<p><figure><img src="/pic/%e5%ae%9e%e7%8e%b0Character%e8%b7%91%e6%ad%a5/%e6%b7%bb%e5%8a%a0%e8%b7%91%e6%ad%a5%e5%8a%a8%e7%94%bb/RunToJumpStart-Condition-UseShare-IsFalling.png" width="800"/>
    </figure>
 <br/></p>
</li>
</ol>
<h3 id="三-成果">
  三、成果
  <a class="anchor" href="#%e4%b8%89-%e6%88%90%e6%9e%9c">#</a>
</h3>
<p>运行游戏，跑步动画正常切换，但跑步和走路的速度一样 <br/>
下一步，实现跑步时提升速度 <br/></p>
<h2 id="part-4-创建-components-stcharactermovementcomponent">
  Part 4 创建 <code>Components/STCharacterMovementComponent</code>
  <a class="anchor" href="#part-4-%e5%88%9b%e5%bb%ba-components-stcharactermovementcomponent">#</a>
</h2>
<p><code>虚幻编辑器</code> <br/>
<code>CharacterMovementComponent</code> <br/></p>
<p><img src="/pic/实现Character跑步/创建派生自CharacterMovementComponent的C++类/基类CharacterMovementComponent.png" alt="基类CharacterMovementComponent.png" width="700" /> <br/>
<code>公有类</code> <br/></p>
<p><figure><img src="/pic/%e5%ae%9e%e7%8e%b0Character%e8%b7%91%e6%ad%a5/%e5%88%9b%e5%bb%ba%e6%b4%be%e7%94%9f%e8%87%aaCharacterMovementComponent%e7%9a%84C&#43;&#43;%e7%b1%bb/Components-STCharacterMovementComponent.png" width="700"/>
</figure>
 <br/></p>
<h2 id="part-5-实现跑步加速">
  Part 5 实现跑步加速
  <a class="anchor" href="#part-5-%e5%ae%9e%e7%8e%b0%e8%b7%91%e6%ad%a5%e5%8a%a0%e9%80%9f">#</a>
</h2>
<p><code>C++</code> <br/></p>
<h3 id="1-dot-添加头文件路径">
  1. 添加头文件路径
  <a class="anchor" href="#1-dot-%e6%b7%bb%e5%8a%a0%e5%a4%b4%e6%96%87%e4%bb%b6%e8%b7%af%e5%be%84">#</a>
</h3>
<p><code>ShootTraining.Build.cs</code> <br/></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>PublicIncludePaths.AddRange(<span style="color:#66d9ef">new</span> <span style="color:#66d9ef">string</span>[] { <span style="color:#e6db74">&#34;ShootTraining/Public/Player&#34;</span>, <span style="color:#e6db74">&#34;ShootTraining/Public/Components&#34;</span> });
</span></span></code></pre></div><h3 id="2-dot-可配置-加速系数">
  2. 可配置 <code>加速系数</code>
  <a class="anchor" href="#2-dot-%e5%8f%af%e9%85%8d%e7%bd%ae-%e5%8a%a0%e9%80%9f%e7%b3%bb%e6%95%b0">#</a>
</h3>
<p><code>STCharacterMovementComponent</code> <br/>
<code>数据成员</code> <code>public</code> <code>原型可修改</code> <code>范围 1.5 - 10</code> <br/></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C++" data-lang="C++"><span style="display:flex;"><span>UPROPERTY(EditDefaultsOnly, meta <span style="color:#f92672">=</span> (ClampMin <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;1.5&#34;</span>, ClampMax <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;10.0&#34;</span>))
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">float</span> SpeedAcceleration <span style="color:#f92672">=</span> <span style="color:#ae81ff">2.0f</span>;
</span></span></code></pre></div><h3 id="3-dot-当-character-跑步时-增加最大速度">
  3. 当 <code>Character</code> 跑步时，增加最大速度
  <a class="anchor" href="#3-dot-%e5%bd%93-character-%e8%b7%91%e6%ad%a5%e6%97%b6-%e5%a2%9e%e5%8a%a0%e6%9c%80%e5%a4%a7%e9%80%9f%e5%ba%a6">#</a>
</h3>
<p><code>STCharacterMovementComponent</code>    <br/>
使用 <code>STBaseCharacter::IsRunning</code> 判断当前是否满足跑步条件 <br/></p>
<ol>
<li>包含头文件 <br/>
<code>源文件</code> <br/>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C++" data-lang="C++"><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&#34;Player/STBaseCharacter.h&#34;</span><span style="color:#75715e">
</span></span></span></code></pre></div></li>
<li>覆写 <code>UCharacterMovementComponent::GetMaxSpeed</code> <br/>
当 <code>Character</code> 满足跑步条件时，增加最大速度 <br/>
并不直接修改 <code>MaxWalkSpeed</code> <br/>
某个地方会调用 <code>GetMaxSpeed</code> 来确定 <code>Character</code> 运动速度的上限，当获取的 <code>MaxSpeed</code> 增加，速度增加的幅度也变大，用以实现加速 <br/>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C++" data-lang="C++"><span style="display:flex;"><span><span style="color:#66d9ef">float</span> USTCharacterMovementComponent<span style="color:#f92672">::</span>GetMaxSpeed() <span style="color:#66d9ef">const</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">float</span> MaxSpeed <span style="color:#f92672">=</span> Super<span style="color:#f92672">::</span>GetMaxSpeed();
</span></span><span style="display:flex;"><span>    ASTBaseCharacter <span style="color:#f92672">*</span>Player <span style="color:#f92672">=</span> Cast<span style="color:#f92672">&lt;</span>ASTBaseCharacter<span style="color:#f92672">&gt;</span>(GetPawnOwner());
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> Player <span style="color:#f92672">&amp;&amp;</span> Player<span style="color:#f92672">-&gt;</span>IsRunning() <span style="color:#f92672">?</span> SpeedAcceleration <span style="color:#f92672">*</span> MaxSpeed : MaxSpeed;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div></li>
</ol>
<h3 id="4-dot-character-使用自定义-charactermovementcomponent">
  4. <code>Character</code> 使用自定义 <code>CharacterMovementComponent</code>
  <a class="anchor" href="#4-dot-character-%e4%bd%bf%e7%94%a8%e8%87%aa%e5%ae%9a%e4%b9%89-charactermovementcomponent">#</a>
</h3>
<p><code>STBaseCharacter</code> <br/></p>
<ol>
<li>包含头文件 <br/>
<code>源文件</code> <br/>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C++" data-lang="C++"><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&#34;Components/STCharacterMovementComponent.h&#34;</span><span style="color:#75715e">
</span></span></span></code></pre></div></li>
<li>屏蔽默认构造函数 <br/></li>
<li>重新实现构造函数 <br/>
自定义组件类型 <br/>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C++" data-lang="C++"><span style="display:flex;"><span>ASTBaseCharacter<span style="color:#f92672">::</span>ASTBaseCharacter(<span style="color:#66d9ef">const</span> FObjectInitializer <span style="color:#f92672">&amp;</span>ObjInit)
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">:</span> Super(ObjInit.SetDefaultSubobjectClass<span style="color:#f92672">&lt;</span>USTCharacterMovementComponent<span style="color:#f92672">&gt;</span>(ACharacter<span style="color:#f92672">::</span>CharacterMovementComponentName))
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Set this character to call Tick() every frame.  You can turn this off to improve performance if you don&#39;t need it.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    PrimaryActorTick.bCanEverTick <span style="color:#f92672">=</span> true;
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// InitCameraComponent();
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    InitSpringArmAndCamera();
</span></span><span style="display:flex;"><span>} 
</span></span></code></pre></div></li>
</ol>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">





</div>



  <script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script>


 
        
      </footer>

      
  
  <div class="book-comments">

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      <div class="book-toc-content">
        
  
<nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#part-1-绑定键位">Part 1 绑定键位</a></li>
        <li><a href="#part-2-实现跑步逻辑">Part 2 实现跑步逻辑</a>
          <ul>
            <li><a href="#一-判断跑步键位是否按下-方向是否为前进">一、判断跑步键位是否按下，方向是否为前进</a></li>
            <li><a href="#二-实现键位按下逻辑-绑定函数描述和回调函数">二、实现键位按下逻辑，绑定函数描述和回调函数</a></li>
            <li><a href="#三-判断方向是否为前进">三、判断方向是否为前进</a></li>
            <li><a href="#四-判断当前是否满足跑步条件">四、判断当前是否满足跑步条件</a></li>
          </ul>
        </li>
        <li><a href="#part-3-添加跑步动画">Part 3 添加跑步动画</a>
          <ul>
            <li><a href="#一-实现跑步动画">一、实现跑步动画</a></li>
            <li><a href="#二-修改-状态机">二、修改 <code>状态机</code></a>
              <ul>
                <li><a href="#1-dot-添加变量-isrunning-用作状态迁移条件">1. 添加变量 <code>IsRunning</code> 用作状态迁移条件</a></li>
                <li><a href="#2-dot-添加转向动画">2. 添加转向动画</a></li>
                <li><a href="#3-dot-复用转换条件">3. 复用转换条件</a></li>
              </ul>
            </li>
            <li><a href="#三-成果">三、成果</a></li>
          </ul>
        </li>
        <li><a href="#part-4-创建-components-stcharactermovementcomponent">Part 4 创建 <code>Components/STCharacterMovementComponent</code></a></li>
        <li><a href="#part-5-实现跑步加速">Part 5 实现跑步加速</a>
          <ul>
            <li><a href="#1-dot-添加头文件路径">1. 添加头文件路径</a></li>
            <li><a href="#2-dot-可配置-加速系数">2. 可配置 <code>加速系数</code></a></li>
            <li><a href="#3-dot-当-character-跑步时-增加最大速度">3. 当 <code>Character</code> 跑步时，增加最大速度</a></li>
            <li><a href="#4-dot-character-使用自定义-charactermovementcomponent">4. <code>Character</code> 使用自定义 <code>CharacterMovementComponent</code></a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>


 
      </div>
    </aside>
    
  </main>

  
</body>
</html>












